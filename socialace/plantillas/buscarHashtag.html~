{% extends 'base.html'%}
{% block content%}

<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>   
<script src="{{STATIC_URL}}js/nivo-slider/ytEmbed-modificado.js" type="text/javascript"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="http://connect.soundcloud.com/sdk.js"></script>
<script type="text/javascript">
var imagenes = {}; // Guarda el URL de las imágenes traísdas desde IG *no es un arreglo, sino un objeto!
var igUrl ="https://api.instagram.com/v1/tags/{{p}}/media/recent/?access_token=563704717.5b9e1e6.4f296fd9e3a5449aa35c2beefb4db0d1";
var mostradas= [];
var page_size = 20;	
</script>


<style>	
	.instagram-placeholder {
	  float: center;
	  width: 80%;
	  height: 80%;
	  padding: 1px;
	  margin: 1px;
	  border: 1px solid #000;
	}
	button.instagram-search {
	  position: fixed;
	  bottom: 20px; right: 140px;
	}
	button.upload {
	  position: fixed;	 
	  bottom: 20px; right: 20px;
	}
	.instagram-hashtag {
	  display: block;
	  font-size: 75%;
	  width: 71%;
	  height: 80%;
	  text-align: center;
	}	
	.ytlist li, .ytlist li a, .ytlist li a img {
		position: relative;
		display: block;
		float: left;
		width: 200px;
		height: 166px;
		margin-right: 5px;
	}    
	.ytlist li { margin: 10px; padding: 5px; list-style: none; }
	.ytlist li.selected { background: #E5E5E5; border: 1px solid #333; }

	
</style>

<!-- title -->
<div id="page-title">
	<span class="title">{{albumes.nombre}}</span>
	<span class="subtitle">Buscando fotos para el album</span>
	 <button class="upload">Subir contenido</button>
</div>
<!-- ENDS title -->

<!-- page-content -->
<div id="page-content">				
	<!-- 3 cols -->
	<div class="one-third">
		<h6><img src="{{STATIC_URL}}img/InstagramLogo.png"  width="80" heigth="80"></h6>			
  		<div class="instagram"></div>
  		<button class="instagram-search">Mas!</button>
		<script type="text/javascript">		
		var palmer= []
		$(function(){	 		
			jQuery('.instagram-search').click(function(evt) {
	 			$.ajax({
					type: "GET",
					dataType: "jsonp", 
					cache: false,
					url: igUrl,
					success: function(response) {
						for (var i = 0; i < response.data.length; i++) {
			     			//jQuery('.instagram-search').text('Buscar Más...');
							igUrl = response.pagination.next_url;
							if ( mostradas.indexOf(response.data[i].images.low_resolution.url)==-1) {
								$(".instagram").append("<div class='instagram-placeholder'><img class='instagram-hashtag' src='" + response.data[i].images.low_resolution.url + "'/><input type='checkbox' id='" + i + "' value='" + response.data[i].images.low_resolution.url + "' class='check'></div>");
								mostradas.push(response.data[i].images.low_resolution.url);
							}
  						} 
						$(".check").click(function(){
					   		if($(this).is(':checked')){
								if ( palmer.indexOf($(this).val())==-1)
								palmer.push($(this).val())
							}
								else{palmer.pop($(this).val())}
						});
					}
				});												
				SC.get('/tracks', { q: '{{p}}', limit: page_size, offset: page_size }, function(tracks) {				
				console.log(tracks);
	    			for (var i = 0; i < tracks.length; i++) {	    	
	    				console.log(tracks[i].uri);	    	
	    				$("p").append('<div class="instagram-placeholder"><iframe width="100%" height="120%" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=' + tracks[i].uri +'&amp;color=a05828&amp;auto_play=false&amp;show_artwork=true"></iframe><input type="checkbox" id='+ i+' value=' + tracks[i].uri +' class="check"><div>');
	    			}
				});								
			});
			jQuery('.upload').click(function(evt) {
    			jQuery.ajax({
			    	type: 'POST',
			    	url: '{% url "guardarFoto" albumes.id %}',
			    	data: {
						'imagenes': palmer,
						'csrfmiddlewaretoken': '{{ csrf_token }}'
	   				}
    			}).done(function() {
        			confirmar=confirm("Ya subieron los archivos, desea seguir subiendo archivos?"); 
        			
        			if (confirmar) 
						alert('Siga subiendo archivos a su album !');
					else 
	
						window.location.href = "{% url 'verAlbumes' %}"; 
				
    			}).fail(function() {
        			alert('No subieron !');
    			});
			});    

		});		
		$.ajax({
			type: "GET",
			dataType: "jsonp", 
			cache: false,
			url: igUrl,
			success: function(response) {
				for (var i = 0; i < response.data.length; i++) {	     		
					igUrl = response.pagination.next_url;
					if ( mostradas.indexOf(response.data[i].images.low_resolution.url)==-1) {
						$(".instagram").append("<div class='instagram-placeholder'><img class='instagram-hashtag' src='" + response.data[i].images.low_resolution.url + "'/><input type='checkbox' id='" + i + "' value='" + response.data[i].images.low_resolution.url + "' class='check'></div>");
						mostradas.push(response.data[i].images.low_resolution.url);
					}
				} 
				$(".check").click(function(){
			   		if($(this).is(':checked')){
						if ( palmer.indexOf($(this).val())==-1)
						palmer.push($(this).val())
					}
						else{palmer.pop($(this).val())}
				});
			}
		});			
		</script>				
	</div>	
	<div class="one-third">
		<h6><img src="{{STATIC_URL}}img/SoundCloud_logo.png""  width="80" heigth="80"> </h6>				
		<p>
		<script>
		//---------------------SOUNCLOUD------------------------------
		SC.initialize({
		  client_id: '1fd6b24c0b9bba2f82dc869df8e2bbb2'
		});		
		var page_size = 20;		
		SC.get('/tracks', { q: '{{p}}',limit: page_size }, function(tracks) {
				console.log(tracks);
	    			for (var i = 0; i < tracks.length; i++) {	    	
	    				console.log(tracks[i].uri);	    	
	    				$("p").append('<div class="instagram-placeholder"><iframe width="100%" height="120%" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=' + tracks[i].uri +'&amp;color=a05828&amp;auto_play=false&amp;show_artwork=true"></iframe><input type="checkbox" id='+ i+' value=' + tracks[i].uri +' class="check"><div>');
	    			}
				});				
		//---------------------END SOUNCLOUD------------------------------		
		</script> </p>
	</div>
	<div class="one-third last">
		<h6><img src="{{STATIC_URL}}img/youtube.png""  width="80" heigth="80"></h6>
		<form id="yt-form" action="#" method="post">
      		<div id="yt-thumbs"></div>      
	    </form>	
    	
    	<script >
		    jQuery(function() {
		        ytEmbed.init({
		            'block':'yt-thumbs',
		            'q':'{{p}}',
		            'type':'search',
		            'results':20,
		            'order':'most_relevance',
		            'player':'embed',
		            'layout':'thumbnails'
		        });
            
		        jQuery('#yt-thumbs').on('click', 'input[type=checkbox]', function(evt) {
					var chkbox = jQuery(evt.target);
					var li = chkbox.parent('li');
					var videos = {};
					var palmer2 =  [];		            
		            if (chkbox.is(':checked')) {
		               li.addClass('selected');			   
					   if ( palmer2.indexOf($(this).val())==-1)
							palmer2.push($(this).val())			
						else{palmer2.pop($(this).val())}
							
						jQuery('.upload').click(function(evt) {			   
							jQuery.ajax({
								type: 'POST',
								url: '{% url "guardarFoto" albumes.id %}',
								data: {
									'videos': palmer2,
									'csrfmiddlewaretoken': '{{ csrf_token }}'
				   				}
							});
						});    		
			        } else {
			           li.removeClass('selected');
			        }
		        });
		    });
        </script>
	</div>	
	<div class="clear "></div>
	<!-- ENDS 3 cols -->
</div>		
{% endblock %}
