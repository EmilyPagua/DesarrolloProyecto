{% extends 'base.html'%}
{% block content%}

<style>	

	.instagram-placeholder {
	  float: center;
	  width: 80%;
	  height: 80%;
	  padding: 1px;
	  margin: 1px;
	  border: 1px solid #000;
	}

	button.instagram-search {
	  position: fixed;
	  bottom: 20px; right: 20px;
	}

	.instagram-hashtag {
	  display: block;
	  font-size: 75%;
	  width: 100%;
	  height: 100%;
	  text-align: center;
	}
</style>


<!-- title -->
<div id="page-title">
	<span class="title">{{albumes.nombre}}</span>
	<span class="subtitle">Buscando fotos para el album</span>
</div>
<!-- ENDS title -->




<!-- page-content -->
<div id="page-content">
	<!-- 3 cols -->
	<div class="one-third">
		<h6><img src="{{STATIC_URL}}img/InstagramLogo.png"  width="80" heigth="80"></h6>	
		<div id="instagram-container">
		  <div id="instagram"></div>		 
		  <button class="instagram-search">Buscar!</button>
		  <button class="upload">Subir imágenes</button>
		</div>
		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  			<div class="instagram"></div>
  			<button class="instagram-search">Buscar!</button>
		<script type="text/javascript">
		var palmer= []
		$(function(){
	 		var imagenes = {}; // Guarda el URL de las imágenes traísdas desde IG *no es un arreglo, sino un objeto!
	 		var igUrl ="https://api.instagram.com/v1/tags/{{p}}/media/recent/?access_token=563704717.5b9e1e6.4f296fd9e3a5449aa35c2beefb4db0d1";
	 		var mostradas= [];
			jQuery('.instagram-search').click(function(evt) {
	 			$.ajax({
					type: "GET",
					dataType: "jsonp", 
					cache: false,
					url: igUrl,
					success: function(response) {
						for (var i = 0; i < response.data.length; i++) {
			     			jQuery('.instagram-search').text('Buscar Más...');
							igUrl = response.pagination.next_url;
							if ( mostradas.indexOf(response.data[i].images.low_resolution.url)==-1) {
								$(".instagram").append("<div class='instagram-placeholder'><img class='instagram-hashtag' src='" + response.data[i].images.low_resolution.url +"'/><input type='checkbox' id='"+ i+"' value='" + response.data[i].images.low_resolution.url +"' class='check'></div>");
								mostradas.push(response.data[i].images.low_resolution.url);
							}
  						} 
						$(".check").click(function(){
					   		if($(this).is(':checked')){
								if ( palmer.indexOf($(this).val())==-1)
								palmer.push($(this).val())
							}
								else{palmer.pop($(this).val())}
						});
					}
				});
			});
			jQuery('.upload').click(function(evt) {
   
    			console.log(imagenes);
    			jQuery.ajax({
			    	type: 'POST',
			    	url: '{% url "guardarFoto" albumes.id %}',
			    	data: {
						'imagenes': palmer,
						'csrfmiddlewaretoken': '{{ csrf_token }}'
	   				}
    			}).done(function() {
        			alert('Ya subieron las imágenes!')
    			}).fail(function() {
        			alert('No subieron!');
    			});
			});    

		});
		</script>		
		
	</div>
	<div class="one-third">
		<h6><img src="{{STATIC_URL}}img/SoundCloud_logo.png""  width="80" heigth="80"> </h6>
		<p>Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus.</p>
	</div>
	<div class="one-third last">
		<h6><img src="{{STATIC_URL}}img/youtube.png""  width="80" heigth="80"></h6>
		<p>Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus.</p>
	</div>
	<div class="clear "></div>
	<!-- ENDS 3 cols -->


</div>
				
{% endblock %}
